{"ast":null,"code":"import configUtil from '../utils/config';\nimport request from '../utils/request';\nimport timeUtil from '../utils/time';\nconst approve = async (payload, chainId, checkIsApproved) => {\n  console.log(chainId);\n  const EARejectErrorMessage = 'Based on your wallet transaction history your application was not approved.';\n  try {\n    var _data$rejectionReason;\n    const {\n      data\n    } = await request.post(`${configUtil.getEAVerseUrl()}/underwrite`, payload);\n    const applicationRejectedError = new Error(EARejectErrorMessage, {\n      cause: {\n        applicationRejected: true\n      }\n    });\n    if (data.statusCode >= 500) {\n      throw applicationRejectedError;\n    } else if (data.status) {\n      throw applicationRejectedError;\n    } else if ((_data$rejectionReason = data.rejectionReason) !== null && _data$rejectionReason !== void 0 && _data$rejectionReason.length) {\n      throw applicationRejectedError;\n    }\n\n    // @TODO: Make the EA service to make sure the transaction is confirmed\n    if (checkIsApproved) {\n      // eslint-disable-next-line no-plusplus\n      for (let i = 0; i < 120; i++) {\n        // eslint-disable-next-line no-await-in-loop\n        const isApproved = await checkIsApproved();\n        if (isApproved) {\n          break;\n        } else {\n          // eslint-disable-next-line no-await-in-loop\n          await timeUtil.sleep(1000);\n        }\n      }\n    }\n    return data;\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  } catch (error) {\n    var _error$message;\n    console.error(error);\n    throw new Error((_error$message = error.message) !== null && _error$message !== void 0 ? _error$message : EARejectErrorMessage, {\n      cause: error.cause\n    });\n  }\n};\nconst approveLender = async (payload, chainId) => {\n  console.log(chainId);\n  const generalErrorMessage = 'Sorry, there was an error approving your wallet as a lender.';\n  try {\n    var _data$rejectionReason2;\n    const {\n      data\n    } = await request.post(`${configUtil.getEABaseUrlV1()}/addApprovedLender`, payload);\n    if (data.statusCode >= 500) {\n      throw new Error(data.errorMessage ? data.errorMessage[0] : generalErrorMessage);\n    } else if (data.status) {\n      throw new Error(data.reason[0]);\n    } else if ((_data$rejectionReason2 = data.rejectionReason) !== null && _data$rejectionReason2 !== void 0 && _data$rejectionReason2.length) {\n      throw new Error(data.rejectionReason[0]);\n    }\n    return data;\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  } catch (error) {\n    var _error$message2;\n    console.error(error);\n    throw new Error((_error$message2 = error.message) !== null && _error$message2 !== void 0 ? _error$message2 : generalErrorMessage, {\n      cause: 'server error'\n    });\n  }\n};\nconst EAService = {\n  approve,\n  approveLender\n};\nexport default EAService;","map":{"version":3,"names":["configUtil","request","timeUtil","approve","payload","chainId","checkIsApproved","console","log","EARejectErrorMessage","data","post","getEAVerseUrl","applicationRejectedError","Error","cause","applicationRejected","statusCode","status","rejectionReason","length","i","isApproved","sleep","error","message","approveLender","generalErrorMessage","getEABaseUrlV1","errorMessage","reason","EAService"],"sources":["/Users/hamzahmahmood/Downloads/ETHDenver/vouch-finance/vouch-finance-frontend/src/services/EAService.ts"],"sourcesContent":["import configUtil from '../utils/config'\nimport request from '../utils/request'\nimport timeUtil from '../utils/time'\n\nexport type EAPayloadType = {\n  poolAddress: string\n  borrowerWalletAddress?: string\n  receivableAddress?: string\n  receivableParam?: string\n}\n\nexport type ApproveInfoType = {\n  aprInBps: number\n  creditLimit: number\n  intervalInDays: number\n  receivableAmount: number\n  receivableAsset: string\n  receivableParam: number | string\n  remainingPeriods: number\n  tokenDecimal: number\n  tokenName: string\n  tokenSymbol: string\n}\n\nconst approve = async (\n  payload: EAPayloadType,\n  chainId: number,\n  checkIsApproved?: () => Promise<boolean>,\n) => {\n  console.log(chainId)\n  const EARejectErrorMessage =\n    'Based on your wallet transaction history your application was not approved.'\n\n  try {\n    const { data } = await request.post(\n      `${configUtil.getEAVerseUrl()}/underwrite`,\n      payload,\n    )\n    const applicationRejectedError = new Error(EARejectErrorMessage, {\n      cause: { applicationRejected: true },\n    })\n    if (data.statusCode >= 500) {\n      throw applicationRejectedError\n    } else if (data.status) {\n      throw applicationRejectedError\n    } else if (data.rejectionReason?.length) {\n      throw applicationRejectedError\n    }\n\n    // @TODO: Make the EA service to make sure the transaction is confirmed\n    if (checkIsApproved) {\n      // eslint-disable-next-line no-plusplus\n      for (let i = 0; i < 120; i++) {\n        // eslint-disable-next-line no-await-in-loop\n        const isApproved = await checkIsApproved()\n        if (isApproved) {\n          break\n        } else {\n          // eslint-disable-next-line no-await-in-loop\n          await timeUtil.sleep(1000)\n        }\n      }\n    }\n\n    return data as ApproveInfoType\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  } catch (error: any) {\n    console.error(error)\n    throw new Error(error.message ?? EARejectErrorMessage, {\n      cause: error.cause,\n    })\n  }\n}\n\nconst approveLender = async (\n  payload: {\n    poolAddress: string\n    lenderWalletAddress: string\n  },\n  chainId: number,\n) => {\n  console.log(chainId)\n  const generalErrorMessage =\n    'Sorry, there was an error approving your wallet as a lender.'\n  try {\n    const { data } = await request.post(\n      `${configUtil.getEABaseUrlV1()}/addApprovedLender`,\n      payload,\n    )\n    if (data.statusCode >= 500) {\n      throw new Error(\n        data.errorMessage ? data.errorMessage[0] : generalErrorMessage,\n      )\n    } else if (data.status) {\n      throw new Error(data.reason[0])\n    } else if (data.rejectionReason?.length) {\n      throw new Error(data.rejectionReason[0])\n    }\n    return data as ApproveInfoType\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  } catch (error: any) {\n    console.error(error)\n    throw new Error(error.message ?? generalErrorMessage, {\n      cause: 'server error',\n    })\n  }\n}\n\nconst EAService = {\n  approve,\n  approveLender,\n}\nexport default EAService\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}