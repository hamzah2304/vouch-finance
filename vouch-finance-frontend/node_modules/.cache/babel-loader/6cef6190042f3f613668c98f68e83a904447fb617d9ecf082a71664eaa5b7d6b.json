{"ast":null,"code":"\"use strict\";\n\n// Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WalletLink = void 0;\nconst WalletLinkAnalytics_1 = require(\"./connection/WalletLinkAnalytics\");\nconst ScopedLocalStorage_1 = require(\"./lib/ScopedLocalStorage\");\nconst WalletLinkProvider_1 = require(\"./provider/WalletLinkProvider\");\nconst WalletLinkSdkUI_1 = require(\"./provider/WalletLinkSdkUI\");\nconst WalletLinkRelay_1 = require(\"./relay/WalletLinkRelay\");\nconst WalletLinkRelayEventManager_1 = require(\"./relay/WalletLinkRelayEventManager\");\nconst util_1 = require(\"./util\");\nconst WALLETLINK_URL = process.env.WALLETLINK_URL || \"https://www.walletlink.org\";\nconst WALLETLINK_VERSION = process.env.WALLETLINK_VERSION || require(\"../package.json\").version || \"unknown\";\nclass WalletLink {\n  /**\n   * Constructor\n   * @param options WalletLink options object\n   */\n  constructor(options) {\n    var _a;\n    this._appName = \"\";\n    this._appLogoUrl = null;\n    this._relay = null;\n    this._relayEventManager = null;\n    const walletLinkUrl = options.walletLinkUrl || WALLETLINK_URL;\n    let walletLinkUIConstructor;\n    if (!options.walletLinkUIConstructor) {\n      walletLinkUIConstructor = opts => new WalletLinkSdkUI_1.WalletLinkSdkUI(opts);\n    } else {\n      walletLinkUIConstructor = options.walletLinkUIConstructor;\n    }\n    if (typeof options.overrideIsMetaMask === \"undefined\") {\n      this._overrideIsMetaMask = false;\n    } else {\n      this._overrideIsMetaMask = options.overrideIsMetaMask;\n    }\n    this._overrideIsCoinbaseWallet = (_a = options.overrideIsCoinbaseWallet) !== null && _a !== void 0 ? _a : true;\n    this._walletLinkAnalytics = options.walletLinkAnalytics ? options.walletLinkAnalytics : new WalletLinkAnalytics_1.WalletLinkAnalytics();\n    const u = new URL(walletLinkUrl);\n    const walletLinkOrigin = `${u.protocol}//${u.host}`;\n    this._storage = new ScopedLocalStorage_1.ScopedLocalStorage(`-walletlink:${walletLinkOrigin}`);\n    this._storage.setItem(\"version\", WalletLink.VERSION);\n    if (typeof window.walletLinkExtension !== \"undefined\") {\n      return;\n    }\n    this._relayEventManager = new WalletLinkRelayEventManager_1.WalletLinkRelayEventManager();\n    this._relay = new WalletLinkRelay_1.WalletLinkRelay({\n      walletLinkUrl,\n      version: WALLETLINK_VERSION,\n      darkMode: !!options.darkMode,\n      walletLinkUIConstructor,\n      storage: this._storage,\n      relayEventManager: this._relayEventManager,\n      walletLinkAnalytics: this._walletLinkAnalytics\n    });\n    this.setAppInfo(options.appName, options.appLogoUrl);\n    this._relay.attachUI();\n  }\n  /**\n   * Create a Web3 Provider object\n   * @param jsonRpcUrl Ethereum JSON RPC URL (Default: \"\")\n   * @param chainId Ethereum Chain ID (Default: 1)\n   * @returns A Web3 Provider\n   */\n  makeWeb3Provider() {\n    let jsonRpcUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n    let chainId = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    if (typeof window.walletLinkExtension !== \"undefined\") {\n      if ( /* eslint-disable @typescript-eslint/ban-ts-comment */\n      // @ts-ignore\n      typeof window.walletLinkExtension.isCipher !== \"boolean\" ||\n      // @ts-ignore\n      !window.walletLinkExtension.isCipher\n      /* eslint-enable @typescript-eslint/ban-ts-comment */) {\n        window.walletLinkExtension.setProviderInfo(jsonRpcUrl, chainId);\n      }\n      return window.walletLinkExtension;\n    }\n    const relay = this._relay;\n    if (!relay || !this._relayEventManager || !this._storage) {\n      throw new Error(\"Relay not initialized, should never happen\");\n    }\n    if (!jsonRpcUrl) relay.setConnectDisabled(true);\n    return new WalletLinkProvider_1.WalletLinkProvider({\n      relayProvider: () => Promise.resolve(relay),\n      relayEventManager: this._relayEventManager,\n      storage: this._storage,\n      jsonRpcUrl,\n      chainId,\n      walletLinkAnalytics: this._walletLinkAnalytics,\n      overrideIsMetaMask: this._overrideIsMetaMask,\n      overrideIsCoinbaseWallet: this._overrideIsCoinbaseWallet\n    });\n  }\n  /**\n   * Set application information\n   * @param appName Application name\n   * @param appLogoUrl Application logo image URL\n   */\n  setAppInfo(appName, appLogoUrl) {\n    var _a;\n    this._appName = appName || \"DApp\";\n    this._appLogoUrl = appLogoUrl || (0, util_1.getFavicon)();\n    if (typeof window.walletLinkExtension !== \"undefined\") {\n      if ( /* eslint-disable @typescript-eslint/ban-ts-comment */\n      // @ts-ignore\n      typeof window.walletLinkExtension.isCipher !== \"boolean\" ||\n      // @ts-ignore\n      !window.walletLinkExtension.isCipher\n      /* eslint-enable @typescript-eslint/ban-ts-comment */) {\n        window.walletLinkExtension.setAppInfo(this._appName, this._appLogoUrl);\n      }\n    } else {\n      (_a = this._relay) === null || _a === void 0 ? void 0 : _a.setAppInfo(this._appName, this._appLogoUrl);\n    }\n  }\n  /**\n   * Disconnect. After disconnecting, this will reload the web page to ensure\n   * all potential stale state is cleared.\n   */\n  disconnect() {\n    var _a;\n    if (typeof window.walletLinkExtension !== \"undefined\") {\n      window.walletLinkExtension.close();\n    } else {\n      (_a = this._relay) === null || _a === void 0 ? void 0 : _a.resetAndReload();\n    }\n  }\n}\nexports.WalletLink = WalletLink;\n/**\n * WalletLink version\n */\nWalletLink.VERSION = WALLETLINK_VERSION;","map":null,"metadata":{},"sourceType":"script","externalDependencies":[]}