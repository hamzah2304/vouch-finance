{"ast":null,"code":"var _jsxFileName = \"/Users/hamzahmahmood/Downloads/ETHDenver/vouch-finance/vouch-finance-frontend/src/features/sdk/CreditLine/components/borrow/Borrow.tsx\",\n  _s = $RefreshSig$();\nimport React, { useCallback, useEffect } from 'react';\nimport { HumaModal, HumaModalHeader } from '../../../../../components/humaModal';\nimport { useContractFunction } from '../../../../../hooks/useContractFunction';\nimport useMount from '../../../../../hooks/useMount';\nimport { useAppDispatch, useAppSelector } from '../../../../../hooks/useRedux';\nimport { CreditState } from '../../../../../utils/credit';\nimport { isTxFailed } from '../../../../../utils/transaction';\nimport { ErrorModal } from '../../../components';\nimport { resetAfterSuccess, setCLBorrowError, setCLBorrowNextStep } from '../../store/creditLine.reducers';\nimport { selectCLState } from '../../store/creditLine.selectors';\nimport { CL_BORROW_STEP } from '../../store/creditLine.store';\nimport { ApproveAllowance } from './ApproveAllowance';\nimport { CheckingEA } from './CheckingEA';\nimport { Loan } from './Loan';\nimport { Success } from './Success';\nimport { Transfer } from './Transfer';\nimport { jsx as _jsx } from \"@emotion/react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"@emotion/react/jsx-runtime\";\nexport function Borrow(_ref) {\n  _s();\n  let {\n    creditRecord,\n    creditRecordStatic,\n    creditAvailableAmount,\n    poolInfo,\n    isOpen,\n    handleClose,\n    handleApprove,\n    handleSuccess\n  } = _ref;\n  const dispatch = useAppDispatch();\n  const {\n    borrowStep,\n    errorMessage,\n    requestLoan\n  } = useAppSelector(selectCLState);\n  const {\n    state,\n    failReason,\n    reset,\n    txReceipt\n  } = useContractFunction(state => state);\n  useMount(() => {\n    if (creditRecord.state >= CreditState.Approved) {\n      dispatch(setCLBorrowNextStep());\n    }\n  });\n  useEffect(() => {\n    if (isTxFailed(state) && failReason) {\n      dispatch(setCLBorrowError({\n        errorMessage: failReason\n      }));\n    }\n  }, [dispatch, failReason, state]);\n  useEffect(() => {\n    if (borrowStep === CL_BORROW_STEP.Done && txReceipt) {\n      handleSuccess(txReceipt.blockNumber);\n    }\n  }, [handleSuccess, borrowStep, txReceipt, requestLoan]);\n  const handleCloseModal = useCallback(() => {\n    reset();\n    dispatch(resetAfterSuccess());\n    handleClose();\n  }, [dispatch, handleClose, reset]);\n\n  // when close modal, return null to make sure all the states are reset\n  if (!isOpen) {\n    return null;\n  }\n  return _jsxs(HumaModal, {\n    isOpen: isOpen,\n    overflowY: \"auto\",\n    onClose: handleCloseModal,\n    width: \"480px\",\n    padding: \"30px 40px\",\n    disableBackdropClick: true,\n    children: [_jsx(HumaModalHeader, {\n      onClose: handleCloseModal,\n      height: 0\n    }), borrowStep === CL_BORROW_STEP.Terms && _jsx(CheckingEA, {\n      poolInfo: poolInfo,\n      handleApprove: handleApprove\n    }), borrowStep === CL_BORROW_STEP.Loan && _jsx(Loan, {\n      poolInfo: poolInfo,\n      creditRecordStatic: creditRecordStatic,\n      creditAvailableAmount: creditAvailableAmount\n    }), borrowStep === CL_BORROW_STEP.ApproveAllowance && _jsx(ApproveAllowance, {\n      poolInfo: poolInfo\n    }), borrowStep === CL_BORROW_STEP.TransferMoney && _jsx(Transfer, {\n      poolInfo: poolInfo\n    }), borrowStep === CL_BORROW_STEP.Done && _jsx(Success, {\n      creditRecord: creditRecord,\n      poolInfo: poolInfo,\n      handleAction: handleCloseModal\n    }), borrowStep === CL_BORROW_STEP.Error && _jsx(ErrorModal, {\n      title: \"Borrow\",\n      errorMessage: errorMessage,\n      handleOk: handleCloseModal\n    })]\n  });\n}\n_s(Borrow, \"BsDtl0idPfgyp/laxLAxwMwXL/U=\", false, function () {\n  return [useAppDispatch, useAppSelector, useContractFunction, useMount];\n});\n_c = Borrow;\nvar _c;\n$RefreshReg$(_c, \"Borrow\");","map":{"version":3,"names":["React","useCallback","useEffect","HumaModal","HumaModalHeader","useContractFunction","useMount","useAppDispatch","useAppSelector","CreditState","isTxFailed","ErrorModal","resetAfterSuccess","setCLBorrowError","setCLBorrowNextStep","selectCLState","CL_BORROW_STEP","ApproveAllowance","CheckingEA","Loan","Success","Transfer","Borrow","creditRecord","creditRecordStatic","creditAvailableAmount","poolInfo","isOpen","handleClose","handleApprove","handleSuccess","dispatch","borrowStep","errorMessage","requestLoan","state","failReason","reset","txReceipt","Approved","Done","blockNumber","handleCloseModal","Terms","TransferMoney","Error"],"sources":["/Users/hamzahmahmood/Downloads/ETHDenver/vouch-finance/vouch-finance-frontend/src/features/sdk/CreditLine/components/borrow/Borrow.tsx"],"sourcesContent":["import React, { useCallback, useEffect } from 'react'\n\nimport { HumaModal, HumaModalHeader } from '../../../../../components/humaModal'\nimport { useContractFunction } from '../../../../../hooks/useContractFunction'\nimport useMount from '../../../../../hooks/useMount'\nimport {\n  CreditRecordStaticType,\n  CreditRecordType,\n} from '../../../../../hooks/usePoolContract'\nimport { useAppDispatch, useAppSelector } from '../../../../../hooks/useRedux'\nimport { CreditState } from '../../../../../utils/credit'\nimport { PoolInfoType } from '../../../../../utils/pool'\nimport { isTxFailed } from '../../../../../utils/transaction'\nimport { ErrorModal } from '../../../components'\nimport {\n  resetAfterSuccess,\n  setCLBorrowError,\n  setCLBorrowNextStep,\n} from '../../store/creditLine.reducers'\nimport { selectCLState } from '../../store/creditLine.selectors'\nimport { CL_BORROW_STEP } from '../../store/creditLine.store'\nimport { ApproveAllowance } from './ApproveAllowance'\nimport { CheckingEA } from './CheckingEA'\nimport { Loan } from './Loan'\nimport { Success } from './Success'\nimport { Transfer } from './Transfer'\n\ntype Props = {\n  creditRecord: CreditRecordType\n  creditRecordStatic: CreditRecordStaticType\n  creditAvailableAmount: number\n  poolInfo: PoolInfoType\n  isOpen: boolean\n  handleClose: () => void\n  handleApprove: () => void\n  handleSuccess: (blockNumber: number) => void\n}\n\nexport function Borrow({\n  creditRecord,\n  creditRecordStatic,\n  creditAvailableAmount,\n  poolInfo,\n  isOpen,\n  handleClose,\n  handleApprove,\n  handleSuccess,\n}: Props): React.ReactElement | null {\n  const dispatch = useAppDispatch()\n  const { borrowStep, errorMessage, requestLoan } =\n    useAppSelector(selectCLState)\n  const { state, failReason, reset, txReceipt } = useContractFunction(\n    (state) => state,\n  )\n\n  useMount(() => {\n    if (creditRecord.state >= CreditState.Approved) {\n      dispatch(setCLBorrowNextStep())\n    }\n  })\n\n  useEffect(() => {\n    if (isTxFailed(state) && failReason) {\n      dispatch(setCLBorrowError({ errorMessage: failReason }))\n    }\n  }, [dispatch, failReason, state])\n\n  useEffect(() => {\n    if (borrowStep === CL_BORROW_STEP.Done && txReceipt) {\n      handleSuccess(txReceipt.blockNumber)\n    }\n  }, [handleSuccess, borrowStep, txReceipt, requestLoan])\n\n  const handleCloseModal = useCallback(() => {\n    reset()\n    dispatch(resetAfterSuccess())\n    handleClose()\n  }, [dispatch, handleClose, reset])\n\n  // when close modal, return null to make sure all the states are reset\n  if (!isOpen) {\n    return null\n  }\n\n  return (\n    <HumaModal\n      isOpen={isOpen}\n      overflowY='auto'\n      onClose={handleCloseModal}\n      width='480px'\n      padding='30px 40px'\n      disableBackdropClick\n    >\n      <HumaModalHeader onClose={handleCloseModal} height={0} />\n      {borrowStep === CL_BORROW_STEP.Terms && (\n        <CheckingEA poolInfo={poolInfo} handleApprove={handleApprove} />\n      )}\n      {borrowStep === CL_BORROW_STEP.Loan && (\n        <Loan\n          poolInfo={poolInfo}\n          creditRecordStatic={creditRecordStatic}\n          creditAvailableAmount={creditAvailableAmount}\n        />\n      )}\n      {borrowStep === CL_BORROW_STEP.ApproveAllowance && (\n        <ApproveAllowance poolInfo={poolInfo} />\n      )}\n      {borrowStep === CL_BORROW_STEP.TransferMoney && (\n        <Transfer poolInfo={poolInfo} />\n      )}\n      {borrowStep === CL_BORROW_STEP.Done && (\n        <Success\n          creditRecord={creditRecord}\n          poolInfo={poolInfo}\n          handleAction={handleCloseModal}\n        />\n      )}\n      {borrowStep === CL_BORROW_STEP.Error && (\n        <ErrorModal\n          title='Borrow'\n          errorMessage={errorMessage}\n          handleOk={handleCloseModal}\n        />\n      )}\n    </HumaModal>\n  )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}